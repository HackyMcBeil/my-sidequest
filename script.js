const CHALLENGES = {
    easy: [
        "Berühre unauffällig dreimal dein linkes Ohr.", "Sage in einem Satz das Wort 'Gurkensalat'.", "Trinke dein Glas in einem Zug leer.", "Stelle eine belanglose Frage über das Wetter.", "Gähne einmal laut und deutlich.", "Rücke deinen Stuhl zwei Mal hintereinander zurecht.", "Putze deine Brille oder reibe dir intensiv die Augen.", "Schau kurz auf dein Handy und kichere leise.", "Streichle dir nachdenklich über das Kinn.", "Verändere deine Sitzposition sehr auffällig.", "Summe für 5 Sekunden eine Melodie leise.", "Überprüfe unauffällig, ob dein Atem riecht.", "Frage in die Runde: 'Hat jemand mal ein Taschentuch?'", "Tippe fünfmal mit dem Fuß im Takt auf den Boden.", "Schau auf deine Uhr und schüttle kurz den Kopf.", "Ordne Gegenstände auf dem Tisch symmetrisch an.", "Fahre dir mit der Hand durch die Haare.", "Verschränke die Arme und atme tief aus.", "Frage jemanden: 'Wann hast du eigentlich Geburtstag?'", "Nimm einen Schluck und sage danach leise 'Ahhh'.", "Kratze dich am Ellenbogen.", "Schau für 10 Sekunden konzentriert an die Decke.", "Putze unauffällig mit dem Finger über dein Display.", "Lockere deinen Nacken durch Kreisen des Kopfes.", "Suche in deiner Tasche nach etwas, das nicht da ist.", "Zähle laut bis drei, bevor du etwas sagst.", "Benutze das Wort 'tatsächlich' zweimal in einem Satz.", "Stelle dein Getränk auf die andere Seite von dir.", "Strecke deine Beine lang unter dem Tisch aus.", "Lies ein Etikett einer Flasche aufmerksam durch.", "Räusper dich zwei Mal kurz hintereinander.", "Zupfe an deinem Ärmel herum.", "Frage: 'Ist es hier eigentlich wärmer geworden?'", "Halte dein Handy ans Ohr (ohne Anruf).", "Wippe für 20 Sekunden leicht mit dem Oberkörper.", "Prüfe, ob deine Schuhe fest sitzen.", "Lächele eine Person grundlos an.", "Trommle mit zwei Fingern kurz auf den Tisch.", "Sage: 'Interessant...' zu einer normalen Aussage.", "Zähle die Fenster im Raum.", "Berühre mit der Zunge deine Oberlippe.", "Puste eine imaginäre Fluse von der Schulter.", "Verstelle deine Stimme für ein Wort.", "Schlage die Beine drei Mal anders übereinander.", "Prüfe deinen Geldbeutel.", "Lobe das Design einer Lampe.", "Knacke mit einem Fingergelenk.", "Rieche kurz an deinem Getränk.", "Nicke drei Mal, während jemand anderes redet.", "Zieh deine Augenbrauen kurz hoch.", "Sage: 'Wie dem auch sei...'", "Prüfe dein Spiegelbild im Handy.", "Sage: 'Verrückt eigentlich.'", "Stütze deinen Kopf auf beide Hände.", "Sage das Wort 'quasi' in einem Satz.", "Bewege deine Zehen sichtbar.", "Frage: 'Geht's euch gut?'", "Streichle über die Tischkante.", "Sage: 'Kann man machen.'", "Rieche an deinem Ärmel.", "Klopfe leise auf dein Knie.", "Tippe mit dem Rhythmus eines Liedes gegen dein Glas.", "Halte dein Glas für 10 Sekunden fest, ohne zu trinken.", "Frage: 'Hat jemand Hunger?'", "Spiele kurz mit einem Feuerzeug.", "Wische dir über die Stirn.", "Frage jemanden: 'Ist das neu?'", "Sage: 'Muss ja, ne?'", "Rücke dein Glas 1cm nach links.", "Tu so als hättest du einen Krümel auf dem Shirt.", "Sage: 'Klassiker!'", "Guck 5 Sekunden aus dem Fenster.", "Reibe deine Handflächen aneinander.", "Nimm das Glas mit der linken Hand.", "Sage: 'Man kennt es.'", "Kratze dich am Kinn.", "Schau kurz auf dein Fingernägel.", "Summe den Ton von 'Alle meine Entchen'.", "Vergleiche die Füllhöhe von zwei Gläsern.", "Puste in dein leeres Glas.", "Rücke deine Socken zurecht.", "Schüttle dein Handy (schlechter Empfang).", "Frage: 'Habt ihr das auch gehört?'", "Überprüfe unauffällig deinen Puls.", "Strecke kurz einen Arm nach oben.", "Tippe dir mit dem Finger an die Schläfe.", "Stelle sicher, dass dein Stuhl 90 Grad zum Tisch steht.", "Knete kurz dein Ohrläppchen.", "Sag das Wort 'Logischerweise'.", "Spiel mit deinem Ring oder deiner Uhr.", "Klopfe Staub von deiner Hose.", "Sage: 'Schwierig.'", "Schau auf deine Handfläche (Notizen).", "Atme hörbar durch die Nase ein.", "Stelle dein Glas auf den alten Abdruck.", "Guck kurz hinter dich.", "Zähle laut bis 3.", "Säubere eine Stelle auf dem Tisch.", "Klopfe dir auf die Wangen.", "Guck auf dein Handy und kichere."
    ],
    medium: [
        "Laufe einmal im Kreis durch den Raum.", "Tausche unauffällig den Platz.", "Flüstere eine belanglose Nachricht.", "Lache laut über einen schlechten Witz.", "Benutze 'fabelhaft' dreimal.", "Behaupte, du hättest eine Spinne gesehen.", "Frage nach der Zeit (Handy in der Hand).", "Summe 10 Sek. 'Happy Birthday'.", "Wiederhole das letzte Wort deines Vorredners als Frage.", "Geh zum Fenster, schau raus, komm kopfschüttelnd zurück.", "Behaupte, du hättest ein Pfeifen im Ohr.", "Erkläre 1 Min. ein fiktives Hobby.", "Benutze eine Redewendung falsch.", "Stelle dein Getränk auf den Boden.", "Klatsche plötzlich (Mücke fangen).", "Frage: 'Riecht es hier nach verbranntem Toast?'", "Mach ein Selfie mit jemandem im Hintergrund.", "Erzähle eine Geschichte, die mittendrin aufhört.", "Verlange ein High-Five.", "Setz dir 2 Min. eine Kapuze auf.", "Stelle Handy auf volle Lautstärke (Ton abspielen).", "Frage: 'Glaubt ihr an Geister?'", "Behaupte ein Déjà-vu zu haben.", "Sprich 1 Min. in 3-Wort-Sätzen.", "Guck jemanden irritiert an.", "Verteile 3 Komplimente.", "Trinke laut mit Strohhalm.", "Zitiere eine Songzeile.", "Halte eine brennende Kerze 10 Sek. an.", "Frage nach Lieblings-Dinosaurier.", "Tu so als hättest du einen Krampf.", "Vorteile von Leitungswasser erklären.", "Sage: 'Du siehst aus wie ein Promi'.", "Putze mit Serviette den Tisch.", "Tippe wild auf dem Handy.", "Verstelle deine Stimme für einen Satz.", "Frage nach Kartenspiel.", "Singe Werbe-Jingle.", "Bitte um Hilfe beim Kette entknoten.", "Behaupte von jemandem geträumt zu haben.", "Verabschiede dich (ohne zu gehen).", "Hüpfe einmal vor Energie.", "Frage nach Wasser (trotz vollem Glas).", "Lies Zutatenliste laut vor.", "Behaupte 4 Liter Wasser getrunken zu haben.", "Frage nach erstem Haustier.", "Starre jemanden 10 Sek. an.", "Zeig in eine leere Ecke.", "Stelle Glas auf den Kopf (leer).", "Alligator vs. Krokodil Diskussion.", "Benutze Wort 'Antiquiert'.", "Lobe die Akustik.", "Frage nach Sternzeichen.", "Gib jemandem einen Spitznamen.", "Halte Glas mit beiden Händen.", "Zombie-Apokalypse Überlebens-Check.", "Sage: 'Erinnert mich an Film XY'.", "Balanciere einen Stift auf dem Finger.", "Frage nach Serien-Empfehlung.", "Huste 3x im Rhythmus.", "Lobe jemanden übertrieben.", "Erzähle von nutzloser App.", "Behaupte Promi-Treffen.", "Holz-Check am Tisch.", "Ananas-Tattoo Idee erwähnen.", "Schlage Gruppenfoto vor.", "Frage nach Musikinstrumenten.", "Sage: 'Das ist typisch ich'.", "Vergiss ein einfaches Wort (Gabel).", "Eichhörnchen-Rettung erfinden.", "Frage nach Lieblings-Monat.", "Zeh ist eingeschlafen.", "Ente-Pferd-Frage stellen.", "Dehnübung machen.", "Frage nach Pizza.", "Neues Wort erfunden.", "Regen-Prognose abgeben.", "Island-Urlaub Wunsch.", "Kaugummi suchen.", "Frage nach WLAN-Passwort.", "Farben-Kompliment Kleidung.", "Ohren wackeln Versuch.", "Peinlicher Moment Frage.", "Vegetarier für 24h Idee.", "Bedeutung Vorname fragen.", "Sage: 'Fühle mich heute blau'.", "Imaginäre Fernbedienung nutzen.", "Bestes Geschenk Frage.", "Schlumpf-Ohrwurm.", "Wettbewerb-Sieg erfinden.", "Delfin-Fakt erzählen.", "Getränk ist besonders nass.", "Schnurrbart-Frage stellen.", "Vortrag über Vorteile von Socken.", "In die Hände klatschen und 'So!' sagen.", "Einen imaginären Hut ziehen.", "Jemanden fragen: 'Bist du sauer?'", "Einen Akzent für genau zwei Sätze nutzen.", "Sagen: 'Das hat mein Opa schon immer gesagt'.", "Lautes Ausatmen gefolgt von 'Tja'."
    ],
    hard: [
        "Zieh Socken falsch herum an.", "Behaupte es hätte geklopft.", "5 Liegestütze mitten im Raum.", "Alle müssen kurz aufstehen.", "Sprich 2 Min. mit Akzent.", "Rede über nasses Wasser (30 Sek).", "Setz dich 1 Min. auf den Boden.", "30 Sek. Schluckauf vortäuschen.", "Hand 5 Sek. nach High-Five halten.", "Panischer Blick aus dem Fenster.", "Handy suchen (in der Hand).", "Luftgitarre spielen (15 Sek).", "Simulation-Theorie diskutieren.", "Sage nach jedem Satz 'Over'.", "In die Ecke stellen (1 Min).", "Geist-SMS behaupten.", "Stuhl-Versicherung verkaufen.", "Schuhe an den Händen tragen.", "Refrain laut singen.", "Wikipedia über Brot vorlesen.", "Foto von Schuhen machen wollen.", "Eignen Namen vergessen.", "Kompliment an eine Gabel.", "1 Min. lang flüstern.", "Streit mit unsichtbarer Person.", "Zeitreisender aus 1920 sein.", "Alle zum Singen bringen.", "Topf als Hut tragen.", "Nur in Reimen sprechen.", "Allergie gegen Wort 'und'.", "Hand halten (Angst).", "Toaster-Entführung erzählen.", "Zeitlupen-Trinken.", "Am Haar von jemandem riechen.", "Mit 'Eure Majestät' ansprechen lassen.", "Zukunft aus Chips lesen.", "Unsichtbarer Hund an Leine.", "Erschütterung der Macht spüren.", "Behaupte du bist Spion.", "Tiergeräusch machen.", "Setzen verlernt.", "La-Ola-Welle starten.", "Glas exen auf Kommando.", "Telepathie mit Katze.", "Mond aus Käse Theorie.", "Pinguin-Diskussion starten.", "Serviette als Krawatte.", "Unsichtbare Brille suchen.", "Lebewesen im Glas retten.", "Nur in Fragen sprechen.", "Erfundene Sprache sprechen.", "Aura reinigen lassen.", "Tanzen ohne Musik.", "Stuhl hat gebissen.", "Angst vor Dunkelheit.", "Werwolf-Verwandlung spielen.", "Schatten verkaufen.", "Haare grün färben Frage.", "Socken vorlesen.", "Phobie gegen 'Sidequest'.", "Farben hören.", "Knie taufen.", "Kaffeemaschinen-Geräusch.", "Rad erfunden.", "Falscher Name für Freunde.", "Unsichtbarer Hut ziehen.", "Löffel auf Nase.", "König eines Kleinstaates.", "Atmen lernen wollen.", "Territorium markieren.", "10 Sek. Gesprächspause & Starren.", "Weltuntergangs-Vision.", "Regierungs-Agent Frage.", "Star Wars summen.", "Angst vor runden Objekten.", "Gartenzwerg-Rechte.", "Linker Arm gehört wem anders.", "Schaufel suchen (vergraben).", "Interview mit Pflanze.", "Durch Wände gehen wollen.", "Luft-Kalorien zählen.", "Formel-1 Geräusch.", "Mit Geräten sprechen.", "Gesicht als Leinwand.", "Majestätisch schreiten.", "Fliege mit Stäbchen fangen.", "Käse-Alter riechen.", "Imaginärer Freund beleidigt.", "Dramatische Ohnmacht.", "Internet gelöscht.", "Sind wir schon da? (3x).", "Fernbedienung für Menschen.", "Angst vor eigenem Schatten.", "Socken ausleihen.", "Letzte Gehirnzelle verloren.", "Hypnotisieren versuchen.", "Allergie gegen Sauerstoff.", "Selfie mit Keks.", "Yoga-Pose für 10 Sekunden.", "Ein fiktives Produkt verkaufen.", "So tun, als würde man unsichtbare Fäden ziehen."
    ]
};

let score = 0;
let cards = [];
let doneChallenges = [];
let usedTexts = new Set();

function startGame() {
    showScreen('screen-game');
    cards = [
        { type: 'easy', text: getNewQuest('easy') },
        { type: 'easy', text: getNewQuest('easy') },
        { type: 'medium', text: getNewQuest('medium') },
        { type: 'medium', text: getNewQuest('medium') },
        { type: 'hard', text: getNewQuest('hard') },
        { type: 'hard', text: getNewQuest('hard') }
    ];
    renderCards();
}

function getNewQuest(lvl) {
    const pool = CHALLENGES[lvl];
    const available = pool.filter(t => !usedTexts.has(t));
    const list = available.length > 0 ? available : pool;
    const picked = list[Math.floor(Math.random() * list.length)];
    usedTexts.add(picked);
    return picked;
}

function renderCards() {
    const container = document.getElementById('card-container');
    container.innerHTML = "";
    cards.slice(0, 3).forEach((card, index) => {
        const div = document.createElement('div');
        div.className = `card ${card.type}`;
        div.innerHTML = `
            <div class="card-text">${card.text}</div>
            <div class="card-ui">
                <span>❌ NEUE KARTE (-2)</span>
                <span>✅ ERLEDIGT (+Pkt)</span>
            </div>`;
        div.onclick = (e) => {
            if (index !== 0) return;
            const rect = div.getBoundingClientRect();
            const success = (e.clientX - rect.left) > rect.width / 2;
            handleAction(success);
        };
        container.appendChild(div);
    });
}

function handleAction(success) {
    const card = cards.shift();
    if (success) {
        score += (card.type === 'easy' ? 5 : card.type === 'medium' ? 10 : 20);
        doneChallenges.push(card);
    } else {
        score -= 2;
    }
    cards.push({ type: card.type, text: getNewQuest(card.type) });
    updateUI();
    renderCards();
}

function updateUI() {
    const el = document.getElementById('display-score');
    if (el) el.innerText = score;
}

function endGameRequest() {
    showScreen('screen-review');
    const list = document.getElementById('review-list');
    list.innerHTML = "";
    doneChallenges.forEach((card, index) => {
        const div = document.createElement('div');
        div.className = "review-item";
        div.id = `review-${index}`;
        div.innerHTML = `<span>${card.text}</span> <button onclick="toggleRemove(${index})">❌</button>`;
        list.appendChild(div);
    });
}

function toggleRemove(index) {
    const item = document.getElementById(`review-${index}`);
    const card = doneChallenges[index];
    const val = (card.type === 'easy' ? 5 : card.type === 'medium' ? 10 : 20);
    if (item.classList.contains('removed')) {
        item.classList.remove('removed');
        score += val;
    } else {
        item.classList.add('removed');
        score -= val;
    }
    updateUI();
}

function showFinalResult() {
    showScreen('screen-result');
    document.getElementById('final-score-display').innerText = score;
}

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}


let score = 0;
let cards = [];
let doneChallenges = []; // Speicher für die Review-Runde
let usedTexts = new Set(); // Verhindert Dopplungen

function startGame() {
    showScreen('screen-game');
    // Initialer Stapel (je 2 pro Stufe)
    cards = [
        { type: 'easy', text: getNewQuest('easy') },
        { type: 'easy', text: getNewQuest('easy') },
        { type: 'medium', text: getNewQuest('medium') },
        { type: 'medium', text: getNewQuest('medium') },
        { type: 'hard', text: getNewQuest('hard') },
        { type: 'hard', text: getNewQuest('hard') }
    ];
    renderCards();
}

function getNewQuest(lvl) {
    const pool = CHALLENGES[lvl];
    // Filtert bereits genutzte aus
    const available = pool.filter(t => !usedTexts.has(t));
    
    // Falls Pool leer, nimm trotzdem eine random (Reset)
    const list = available.length > 0 ? available : pool;
    const picked = list[Math.floor(Math.random() * list.length)];
    
    usedTexts.add(picked);
    return picked;
}

function renderCards() {
    const container = document.getElementById('card-container');
    container.innerHTML = "";
    
    cards.slice(0, 3).forEach((card, index) => {
        const div = document.createElement('div');
        div.className = `card ${card.type}`;
        div.innerHTML = `
            <div class="card-text">${card.text}</div>
            <div class="card-ui">
                <span>❌ NEUE KARTE (-2)</span>
                <span>✅ ERLEDIGT (+Pkt)</span>
            </div>`;
        
        div.onclick = (e) => {
            if (index !== 0) return;
            const rect = div.getBoundingClientRect();
            const success = (e.clientX - rect.left) > rect.width / 2;
            handleAction(success);
        };
        container.appendChild(div);
    });
}

function handleAction(success) {
    const card = cards.shift();
    if (success) {
        score += (card.type === 'easy' ? 5 : card.type === 'medium' ? 10 : 20);
        doneChallenges.push(card); // Für Review merken
    } else {
        score -= 2;
    }
    
    cards.push({ type: card.type, text: getNewQuest(card.type) });
    updateUI();
    renderCards();
}

function updateUI() {
    document.getElementById('display-score').innerText = score;
}

function endGameRequest() {
    showScreen('screen-review');
    const list = document.getElementById('review-list');
    list.innerHTML = "";
    
    doneChallenges.forEach((card, index) => {
        const div = document.createElement('div');
        div.className = "review-item";
        div.id = `review-${index}`;
        div.innerHTML = `<span>${card.text}</span> <button onclick="toggleRemove(${index})">❌</button>`;
        list.appendChild(div);
    });
}

function toggleRemove(index) {
    const item = document.getElementById(`review-${index}`);
    const card = doneChallenges[index];
    const val = (card.type === 'easy' ? 5 : card.type === 'medium' ? 10 : 20);

    if (item.classList.contains('removed')) {
        item.classList.remove('removed');
        score += val;
    } else {
        item.classList.add('removed');
        score -= val;
    }
    updateUI();
}

function showFinalResult() {
    showScreen('screen-result');
    document.getElementById('final-score-display').innerText = score;
}

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

